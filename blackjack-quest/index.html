<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BLACKJACK QUEST PRO DELUXE ULTIMATE EDITION â„¢Â©Â®</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&display=swap');

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: repeating-linear-gradient(
      45deg,
      #8B0000 0px, #8B0000 20px,
      #6B0000 20px, #6B0000 40px
    );
    font-family: 'Times New Roman', Times, serif;
    overflow-x: hidden;
  }

  /* â”€â”€ SEIZURE HEADER â”€â”€ */
  #top-ticker {
    background: linear-gradient(90deg, #000 0%, #111 50%, #000 100%);
    border-top: 4px solid gold;
    border-bottom: 4px solid gold;
    color: gold;
    font-size: 0.85rem;
    padding: 4px 0;
    white-space: nowrap;
    overflow: hidden;
  }
  #ticker-inner {
    display: inline-block;
    animation: ticker 18s linear infinite;
    font-family: 'Courier New', monospace;
    letter-spacing: 2px;
  }
  @keyframes ticker {
    from { transform: translateX(100vw); }
    to   { transform: translateX(-100%); }
  }

  /* â”€â”€ TITLE BANNER â”€â”€ */
  .title-banner {
    background: linear-gradient(180deg, #1a0000, #4a0000, #8B0000, #4a0000, #1a0000);
    border-top: 6px double gold;
    border-bottom: 6px double gold;
    text-align: center;
    padding: 3px 0 2px;
    position: relative;
  }

  .title-main {
    font-family: 'Playfair Display', 'Times New Roman', serif;
    font-size: 2rem;
    font-weight: 900;
    color: gold;
    text-shadow: 3px 3px 0 #000, -1px -1px 0 #8B6914, 0 0 30px gold, 0 0 60px #ff6600;
    letter-spacing: 4px;
    animation: titlePulse 1.5s ease-in-out infinite alternate;
  }
  @keyframes titlePulse {
    from { text-shadow: 3px 3px 0 #000, 0 0 20px gold, 0 0 40px #ff6600; }
    to   { text-shadow: 3px 3px 0 #000, 0 0 40px gold, 0 0 80px #ffaa00, 0 0 100px #ff6600; }
  }

  .title-sub {
    font-size: 0.7rem;
    color: #ffcc00;
    letter-spacing: 6px;
    text-transform: uppercase;
    margin-top: -4px;
  }

  .stars-row {
    color: gold;
    font-size: 1.2rem;
    letter-spacing: 3px;
    animation: starSpin 2s linear infinite;
  }
  @keyframes starSpin {
    0%,100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  /* â”€â”€ GOLD RIM EVERYTHING â”€â”€ */
  .gold-rim {
    border: 4px solid gold;
    box-shadow:
      0 0 0 2px #8B6914,
      0 0 0 4px gold,
      0 0 0 6px #8B6914,
      inset 0 0 0 2px #8B6914,
      0 0 20px rgba(255, 215, 0, 0.5),
      0 0 40px rgba(255, 165, 0, 0.3);
  }

  /* â”€â”€ THREE-COLUMN LAYOUT â”€â”€ */
  .page-layout {
    display: grid;
    grid-template-columns: 180px 1fr 180px;
    height: calc(100vh - 88px);
    gap: 0;
    overflow: hidden;
  }

  /* â”€â”€ AD SIDEBAR â”€â”€ */
  .sidebar {
    background: #0a0a0a;
    border-left: 3px solid gold;
    border-right: 3px solid gold;
    padding: 6px 5px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .fake-ad {
    background: linear-gradient(135deg, #1a0a2e, #0d1b4a, #1a0a2e);
    border: 3px solid gold;
    border-radius: 4px;
    padding: 8px;
    text-align: center;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    box-shadow: inset 0 0 15px rgba(0,0,255,0.3), 0 0 10px rgba(255,215,0,0.4);
  }
  .fake-ad:hover { filter: brightness(1.2); }

  .fake-ad::before {
    content: 'â˜… AD â˜…';
    position: absolute;
    top: 2px; right: 3px;
    font-size: 0.5rem;
    color: rgba(255,215,0,0.5);
    letter-spacing: 1px;
  }

  .ad-title {
    font-family: Impact, Arial Black, sans-serif;
    font-size: 0.85rem;
    color: #ff0;
    text-transform: uppercase;
    line-height: 1.2;
    text-shadow: 1px 1px 0 #000, 0 0 8px #ff0;
    margin-bottom: 4px;
  }
  .ad-sub {
    font-size: 0.6rem;
    color: #aef;
    font-family: 'Courier New', monospace;
    line-height: 1.3;
  }
  .ad-cta {
    display: inline-block;
    margin-top: 5px;
    background: linear-gradient(90deg, #ff4400, #ff0000, #ff4400);
    color: #fff;
    font-family: Impact, sans-serif;
    font-size: 0.75rem;
    padding: 3px 8px;
    border: 2px solid #ffaa00;
    letter-spacing: 1px;
    animation: ctaPulse 0.8s ease infinite alternate;
  }
  @keyframes ctaPulse {
    from { box-shadow: 0 0 5px #ff0; }
    to   { box-shadow: 0 0 15px #ff0, 0 0 25px red; }
  }

  .ad-icon { font-size: 1.8rem; line-height: 1; margin-bottom: 3px; }

  .ad-marquee {
    font-size: 0.55rem;
    color: #0f0;
    font-family: 'Courier New', monospace;
    overflow: hidden;
    white-space: nowrap;
  }
  .ad-marquee-inner {
    display: inline-block;
    animation: marquee 6s linear infinite;
  }
  @keyframes marquee {
    from { transform: translateX(100%); }
    to   { transform: translateX(-100%); }
  }

  /* â”€â”€ GAME AREA â”€â”€ */
  .game-area {
    background: radial-gradient(ellipse at center, #1a4a2a 0%, #0d2e18 60%, #061409 100%);
    padding: 8px 14px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    position: relative;
    overflow: hidden;
  }

  /* â”€â”€ HUD â”€â”€ */
  .hud-bar {
    background: linear-gradient(90deg, #000, #1a0000, #000);
    border-top: 3px double gold;
    border-bottom: 3px double gold;
    border-left: 3px solid gold;
    border-right: 3px solid gold;
    padding: 6px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
  }

  .hud-item { text-align: center; }
  .hud-label {
    font-size: 0.55rem;
    text-transform: uppercase;
    letter-spacing: 3px;
    color: #cc9900;
    font-family: 'Courier New', monospace;
  }
  .hud-value {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-weight: 700;
    color: gold;
    text-shadow: 0 0 10px gold;
  }

  /* â”€â”€ ZONES â”€â”€ */
  .zone {
    background: rgba(0, 0, 0, 0.5);
    border: 4px solid gold;
    box-shadow:
      0 0 0 2px #8B6914,
      0 0 0 4px gold,
      inset 0 0 20px rgba(0,0,0,0.8),
      0 0 20px rgba(255,215,0,0.3);
    border-radius: 2px;
    padding: 8px 12px;
    min-height: 120px;
    position: relative;
  }

  .zone::before {
    content: '';
    position: absolute;
    inset: 4px;
    border: 1px solid rgba(255,215,0,0.2);
    pointer-events: none;
  }

  .zone-label {
    font-family: 'Playfair Display', serif;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 4px;
    color: gold;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }

  .hand-value {
    background: #000;
    border: 2px solid gold;
    border-radius: 0;
    padding: 1px 8px;
    font-size: 0.85rem;
    font-weight: 700;
    color: gold;
    font-family: 'Courier New', monospace;
    box-shadow: 0 0 8px gold;
  }
  .hand-value.bust { border-color: #f00; color: #f00; box-shadow: 0 0 8px red; animation: bustBlink 0.4s step-end infinite; }
  .hand-value.bj   { border-color: #0f0; color: #0f0; box-shadow: 0 0 8px lime; animation: bjGlow 0.5s ease infinite alternate; }

  @keyframes bustBlink { 0%,100% { opacity: 1; } 50% { opacity: 0; } }
  @keyframes bjGlow    { from { box-shadow: 0 0 8px lime; } to { box-shadow: 0 0 25px lime, 0 0 50px #00ff00; } }

  .cards {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    min-height: 84px;
    align-items: flex-start;
  }

  /* â”€â”€ CARDS â”€â”€ */
  .card-wrapper { perspective: 600px; width: 58px; height: 87px; flex-shrink: 0; }

  .card {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.4s ease;
  }
  .card.flipped { transform: rotateY(180deg); }

  .card-face, .card-back-face {
    position: absolute;
    inset: 0;
    border-radius: 3px;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card-face {
    background: #fffdf8;
    border: 3px solid gold;
    box-shadow: 0 0 0 1px #8B6914, 0 4px 12px rgba(0,0,0,0.8), inset 0 0 0 2px rgba(255,215,0,0.1);
    flex-direction: column;
    padding: 3px;
  }

  .card-face .corner {
    position: absolute;
    font-size: 0.7rem;
    font-weight: 700;
    font-family: 'Playfair Display', serif;
    line-height: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .card-face .corner.tl { top: 3px; left: 4px; }
  .card-face .corner.br { bottom: 3px; right: 4px; transform: rotate(180deg); }
  .card-face .center-suit { font-size: 1.5rem; line-height: 1; }
  .card-face.red * { color: #cc0000; }
  .card-face.black * { color: #111; }

  .card-back-face {
    background:
      repeating-linear-gradient(45deg, #8B0000 0, #8B0000 5px, #6B0000 5px, #6B0000 10px);
    border: 3px solid gold;
    box-shadow: 0 0 0 1px #8B6914, 0 4px 12px rgba(0,0,0,0.8);
    transform: rotateY(180deg);
    font-size: 1.6rem;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-25px) scale(0.8) rotate(-5deg); }
    to   { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
  }
  .card-wrapper.new { animation: slideIn 0.3s cubic-bezier(0.34,1.56,0.64,1) forwards; }

  /* â”€â”€ MESSAGE â”€â”€ */
  .message-area { min-height: 40px; display: flex; align-items: center; justify-content: center; }

  .message {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-weight: 900;
    letter-spacing: 3px;
    text-transform: uppercase;
    padding: 5px 18px;
    border: 4px double gold;
    box-shadow: 0 0 0 2px #8B6914, 0 0 30px rgba(255,215,0,0.4);
    animation: popIn 0.35s cubic-bezier(0.175,0.885,0.32,1.275) forwards;
  }
  @keyframes popIn {
    from { opacity: 0; transform: scale(0.5) rotate(-3deg); }
    to   { opacity: 1; transform: scale(1) rotate(0deg); }
  }
  .message.win  { background: #001a00; color: lime; border-color: lime; text-shadow: 0 0 15px lime; }
  .message.lose { background: #1a0000; color: #ff3333; border-color: red; text-shadow: 0 0 15px red; animation: popIn 0.35s cubic-bezier(0.175,0.885,0.32,1.275) forwards, loseBlink 0.3s step-end 3; }
  .message.push { background: #1a1000; color: #ffaa00; border-color: #ffaa00; }
  .message.info { background: #000; color: gold; }
  @keyframes loseBlink { 0%,100%{opacity:1} 50%{opacity:0.4} }

  /* â”€â”€ BET AREA â”€â”€ */
  .bet-area {
    background: linear-gradient(135deg, #0a0500, #1a0e00, #0a0500);
    border: 4px solid gold;
    box-shadow: 0 0 0 2px #8B6914, 0 0 20px rgba(255,215,0,0.2), inset 0 0 20px rgba(0,0,0,0.5);
    padding: 7px 12px;
  }

  .bet-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 5px;
  }
  .bet-label {
    font-family: 'Playfair Display', serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    color: #cc9900;
    text-transform: uppercase;
    min-width: 90px;
  }
  .current-bet {
    font-family: 'Courier New', monospace;
    font-size: 1.5rem;
    font-weight: 700;
    color: gold;
    text-shadow: 0 0 12px gold;
    min-width: 80px;
  }

  /* Chips */
  .chip {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    border: 4px solid;
    font-family: Impact, 'Arial Black', sans-serif;
    font-size: 0.75rem;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    line-height: 1;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
  }
  .chip::before {
    content: '';
    position: absolute;
    inset: 5px;
    border-radius: 50%;
    border: 2px dashed rgba(255,255,255,0.3);
    pointer-events: none;
  }
  .chip:hover:not(:disabled) { transform: translateY(-4px) scale(1.1); }
  .chip:active:not(:disabled) { transform: scale(0.92); }
  .chip:disabled { opacity: 0.25; cursor: not-allowed; transform: none !important; }

  .chip-10  { background: radial-gradient(#3498db, #1a5276); border-color: #aed6f1; color: #fff; box-shadow: 0 4px 0 #1a3a52, 0 0 12px rgba(52,152,219,0.5); }
  .chip-25  { background: radial-gradient(#2ecc71, #1a7a42); border-color: #a9dfbf; color: #fff; box-shadow: 0 4px 0 #0e4424, 0 0 12px rgba(46,204,113,0.5); }
  .chip-50  { background: radial-gradient(#9b59b6, #5e2d73); border-color: #d7bde2; color: #fff; box-shadow: 0 4px 0 #3d1a4a, 0 0 12px rgba(155,89,182,0.5); }
  .chip-100 { background: radial-gradient(#e74c3c, #7b241c); border-color: #f1948a; color: #fff; box-shadow: 0 4px 0 #4a1010, 0 0 12px rgba(231,76,60,0.5); }

  .chip-clear {
    background: transparent;
    border-color: #666;
    color: #888;
    font-size: 0.6rem;
    box-shadow: none;
  }
  .chip-clear:hover:not(:disabled) { border-color: red; color: red; box-shadow: 0 0 10px red; }

  /* â”€â”€ ACTION BUTTONS â”€â”€ */
  .actions { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }

  .btn {
    padding: 8px 18px;
    border: 3px solid gold;
    border-radius: 0;
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
    box-shadow: 0 0 0 1px #8B6914, 0 4px 0 #8B6914, 0 0 15px rgba(255,215,0,0.2);
    position: relative;
  }
  .btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 0 0 1px #8B6914, 0 7px 0 #8B6914, 0 0 25px rgba(255,215,0,0.4); }
  .btn:active:not(:disabled) { transform: translateY(2px); box-shadow: 0 0 0 1px #8B6914, 0 2px 0 #8B6914; }
  .btn:disabled { opacity: 0.25; cursor: not-allowed; transform: none; }

  .btn-deal   { background: linear-gradient(135deg, #8B6914, #c9a84c, #8B6914); color: #000; min-width: 140px; font-size: 1.1rem; animation: dealGlow 1.5s ease infinite alternate; }
  @keyframes dealGlow { from { box-shadow: 0 0 0 1px #8B6914, 0 4px 0 #8B6914, 0 0 15px rgba(255,215,0,0.3); } to { box-shadow: 0 0 0 1px #8B6914, 0 4px 0 #8B6914, 0 0 40px rgba(255,215,0,0.7), 0 0 60px rgba(255,165,0,0.4); } }
  .btn-deal:disabled { animation: none; }
  .btn-hit    { background: linear-gradient(135deg, #145a14, #2ecc71, #145a14); color: #fff; }
  .btn-stand  { background: linear-gradient(135deg, #5a1414, #e74c3c, #5a1414); color: #fff; }
  .btn-double { background: linear-gradient(135deg, #3d1460, #9b59b6, #3d1460); color: #fff; }
  .btn-new    { background: linear-gradient(135deg, #144a5a, #3498db, #144a5a); color: #fff; min-width: 140px; }

  /* â”€â”€ STREAK â”€â”€ */
  .streak-row {
    display: flex;
    gap: 5px;
    justify-content: center;
    align-items: center;
    font-size: 0.6rem;
    color: #8B6914;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-family: 'Courier New', monospace;
  }
  .streak-dot { width: 10px; height: 10px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); }
  .streak-dot.w { background: lime; box-shadow: 0 0 4px lime; }
  .streak-dot.l { background: red;  box-shadow: 0 0 4px red; }
  .streak-dot.p { background: #ffaa00; box-shadow: 0 0 4px #ffaa00; }

  /* â”€â”€ WINNER WATERMARK â”€â”€ */
  .winner-stamp {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) rotate(-20deg);
    font-family: Impact, sans-serif;
    font-size: 4rem;
    color: rgba(255,215,0,0.04);
    white-space: nowrap;
    pointer-events: none;
    letter-spacing: 6px;
    text-transform: uppercase;
  }

  /* â”€â”€ DEALER HAND SVGs (two hands) â”€â”€ */
  .dealer-hand-svg {
    position: absolute;
    width: 92px;
    top: -200px;
    transition: top 0.42s cubic-bezier(0.25,0.46,0.45,0.94);
    pointer-events: none;
    z-index: 20;
    filter: drop-shadow(2px 6px 12px rgba(0,0,0,0.75));
  }
  .dealer-hand-svg.dealing { top: 42px; }
  #dealer-hand-left  { left: calc(50% - 100px); }
  #dealer-hand-right { left: calc(50% + 8px); transform: scaleX(-1); }

  /* â”€â”€ DIALOGUE BAR (point-and-click style) â”€â”€ */
  .dialogue-bar {
    display: none;
    position: absolute;
    bottom: 0; left: 0; right: 0;
    background: #06070e;
    border-top: 3px solid gold;
    box-shadow: 0 -8px 30px rgba(0,0,0,0.95);
    padding: 10px 14px 12px;
    flex-direction: row;
    gap: 12px;
    align-items: flex-start;
    z-index: 60;
    min-height: 80px;
  }
  .dialogue-bar.visible { display: flex; }

  .dialogue-portrait {
    width: 44px;
    height: 56px;
    flex-shrink: 0;
    display: flex;
    align-items: flex-start;
  }

  .dialogue-content { flex: 1; }

  .dialogue-speaker {
    font-family: 'Courier New', monospace;
    font-size: 0.58rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: gold;
    margin-bottom: 4px;
  }

  .dialogue-speech {
    font-family: 'Courier New', monospace;
    color: #ddd;
    font-size: 0.82rem;
    line-height: 1.55;
    margin-bottom: 8px;
  }

  .dialogue-choices {
    display: flex;
    flex-direction: column;
    gap: 1px;
  }

  .dialogue-choice {
    font-family: 'Courier New', monospace;
    background: none;
    border: none;
    color: #c9a84c;
    cursor: pointer;
    font-size: 0.78rem;
    padding: 2px 0 2px 0;
    text-align: left;
    display: block;
    transition: color 0.08s, padding-left 0.1s;
    letter-spacing: 0.5px;
  }
  .dialogue-choice::before { content: 'â–¶  '; opacity: 0.45; font-size: 0.65rem; }
  .dialogue-choice:hover { color: #fff; padding-left: 5px; }
  .dialogue-choice:hover::before { opacity: 1; }

  /* â”€â”€ GAME OVER â”€â”€ */
  .game-over-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.9);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 20px; z-index: 100;
  }
  .game-over-title {
    font-family: 'Playfair Display', serif;
    font-size: 4rem;
    font-weight: 900;
    color: gold;
    text-shadow: 0 0 30px gold, 0 0 60px orange;
    letter-spacing: 6px;
    animation: titlePulse 0.8s ease infinite alternate;
  }
  .game-over-sub { color: #cc9900; font-size: 0.9rem; letter-spacing: 3px; font-family: 'Courier New', monospace; }

  /* â”€â”€ BOTTOM TICKER â”€â”€ */
  .bottom-ticker {
    background: #000;
    border-top: 4px double gold;
    color: #0f0;
    font-family: 'Courier New', monospace;
    font-size: 0.7rem;
    padding: 3px 0;
    overflow: hidden;
    white-space: nowrap;
  }
  .bottom-ticker-inner {
    display: inline-block;
    animation: ticker 22s linear infinite reverse;
    letter-spacing: 2px;
  }

  /* â”€â”€ TRUST BADGES â”€â”€ */
  .trust-bar {
    background: linear-gradient(90deg, #000, #0a0500, #000);
    border-top: 2px solid gold;
    border-bottom: 2px solid gold;
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 5px 0;
    flex-wrap: wrap;
  }
  .trust-badge {
    font-family: 'Courier New', monospace;
    font-size: 0.55rem;
    color: #8B6914;
    letter-spacing: 1px;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* mobile */
  @media (max-width: 768px) {
    .page-layout { grid-template-columns: 1fr; }
    .sidebar { display: none; }
    .title-main { font-size: 1.6rem; }
  }
</style>
</head>
<body>

<!-- TOP TICKER -->
<div id="top-ticker">
  <span id="ticker-inner">
    ğŸƒ JACKPOT ALERT: User "CasinoKing99" just won $49,999 !! &nbsp;â˜…&nbsp; FREE SPINS AVAILABLE NOW &nbsp;â˜…&nbsp; MEGA BLACKJACK DELUXE â€” 500% WELCOME BONUS &nbsp;â˜…&nbsp; ğŸ”¥ HOT TABLE TONIGHT: 14 BLACKJACKS IN A ROW ğŸ”¥ &nbsp;â˜…&nbsp; DOWNLOAD OUR APP FOR EVEN MORE LOSSES &nbsp;â˜…&nbsp; THE HOUSE ALWAYS WINS... OR DOES IT? &nbsp;â˜…&nbsp; CLICK HERE TO CLAIM YOUR FREE $10,000 &nbsp;â˜…&nbsp;
  </span>
</div>

<!-- TITLE -->
<div class="title-banner">
  <div class="title-main">â™  BLACKJACK QUEST â™ </div>
  <div class="title-sub">PRO DELUXE ULTIMATE CHAMPIONSHIP EDITIONâ„¢ &nbsp;â˜…&nbsp; ğŸ”’ SSL SECURED &nbsp;â˜…&nbsp; âœ… CERTIFIED FAIR &nbsp;â˜…&nbsp; ğŸ† #1 SINCE 1999 &nbsp;â˜…&nbsp; âš¡ INSTANT PLAY</div>
</div>

<!-- THREE COLUMN LAYOUT -->
<div class="page-layout">

  <!-- LEFT SIDEBAR ADS -->
  <div class="sidebar">

    <div class="fake-ad" onclick="void(0)">
      <div class="ad-icon">ğŸƒ</div>
      <div class="ad-title">MEGA BLACKJACK PRO 2000!!</div>
      <div class="ad-sub">Play with REAL dealers!<br>500% WELCOME BONUS!<br>No wagering required*</div>
      <div class="ad-cta">PLAY FREE NOW</div>
      <div class="ad-marquee"><span class="ad-marquee-inner">â˜… LIMITED TIME OFFER â˜… 24HRS ONLY â˜…</span></div>
    </div>

    <div class="fake-ad" onclick="void(0)">
      <div class="ad-icon">ğŸ’°</div>
      <div class="ad-title">BLACKJACK KINGS CASINO</div>
      <div class="ad-sub">$10,000 sign-up bonus!<br>Over 1,000 games!<br>Rated â­â­â­â­â­</div>
      <div class="ad-cta">JOIN NOW!</div>
    </div>

    <div class="fake-ad" onclick="void(0)" style="background: linear-gradient(135deg,#1a1a00,#3a3a00,#1a1a00); box-shadow: inset 0 0 15px rgba(255,255,0,0.2), 0 0 10px rgba(255,215,0,0.4);">
      <div class="ad-icon">ğŸ°</div>
      <div class="ad-title" style="color:#ff0; font-size:1rem;">JACKPOT PALACE</div>
      <div class="ad-sub" style="color:#ffd">Progressive jackpots!<br>$2.4M up for grabs<br>RIGHT NOW!!</div>
      <div class="ad-cta" style="background: linear-gradient(90deg,#ffaa00,#ff6600,#ffaa00); color:#000;">SPIN TO WIN</div>
    </div>

    <div class="fake-ad" onclick="void(0)" style="background: linear-gradient(135deg,#001a00,#003300); border-color:lime; box-shadow: 0 0 15px lime;">
      <div class="ad-icon">ğŸ¤‘</div>
      <div class="ad-title" style="color:lime;">LUCKY ACES ONLINE</div>
      <div class="ad-sub" style="color:#afa;">FREE chips daily!<br>VIP program available<br>Withdraw anytime!â€ </div>
      <div class="ad-cta" style="background:linear-gradient(90deg,#006600,#00aa00,#006600);">CLAIM CHIPS</div>
      <div class="ad-marquee"><span class="ad-marquee-inner" style="color:lime;">â€  TERMS APPLY â˜… 18+ â˜… GAMBLE RESPONSIBLY â˜…</span></div>
    </div>

    <div class="fake-ad" onclick="void(0)">
      <div class="ad-icon">â™¦</div>
      <div class="ad-title">DIAMOND CLUB VIP</div>
      <div class="ad-sub">Exclusive members only!<br>Private tables available<br>Butler service*</div>
      <div class="ad-cta">APPLY NOW</div>
    </div>

    <div style="text-align:center; font-family:'Courier New',monospace; font-size:0.5rem; color:#444; letter-spacing:1px; padding: 4px;">
      *TERMS AND CONDITIONS APPLY.<br>
      18+ ONLY. GAMBLING INVOLVES RISK.<br>
      Please play responsibly.<br>
      This is a fake ad.
    </div>

  </div>

  <!-- MAIN GAME -->
  <div class="game-area">
    <div class="winner-stamp">YOU ARE A WINNER</div>

    <!-- DEALER HANDS (left + right, both slide in from above) -->
    <svg id="dealer-hand-left" class="dealer-hand-svg" viewBox="0 0 110 190" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="hf-l">
          <feTurbulence type="fractalNoise" baseFrequency="0.85" numOctaves="4" result="n"/>
          <feDisplacementMap in="SourceGraphic" in2="n" scale="1.4" xChannelSelector="R" yChannelSelector="G"/>
        </filter>
        <radialGradient id="palmG-l" cx="50%" cy="65%">
          <stop offset="0%" stop-color="#d4906a"/>
          <stop offset="100%" stop-color="#a86040"/>
        </radialGradient>
      </defs>
      <g filter="url(#hf-l)">
        <path d="M8,94 C6,70 6,44 8,18 C10,6 14,2 19,2 C24,2 28,6 29,18 C31,44 30,70 28,94 Z" fill="#c8886a"/>
        <path d="M31,108 C29,78 28,50 30,20 C31,6 37,1 43,1 C49,1 53,7 54,20 C56,50 55,78 53,108 Z" fill="#cb8e6e"/>
        <path d="M56,122 C54,88 53,56 55,20 C57,5 63,0 69,0 C75,0 79,5 81,20 C83,56 82,88 80,122 Z" fill="#c88a6a"/>
        <path d="M83,110 C81,80 80,52 82,22 C83,8 89,3 95,3 C101,3 105,9 106,22 C108,52 107,80 105,110 Z" fill="#c5866a"/>
        <path d="M8,94 C6,120 7,152 12,164 C20,176 44,182 62,182 C80,182 98,176 104,164 C109,150 110,120 105,110 C98,114 88,118 69,118 C50,118 34,114 26,108 C18,104 10,100 8,94 Z" fill="url(#palmG-l)"/>
        <path d="M104,132 C110,120 118,123 120,136 C122,150 116,166 106,170 C98,173 93,164 93,152 C93,140 97,130 104,132 Z" fill="#c5876a"/>
      </g>
      <g fill="none" stroke="#8a4e2a" stroke-linecap="round" opacity="0.65">
        <path d="M9,76 Q18,74 27,76" stroke-width="1"/><path d="M10,58 Q18,56 26,58" stroke-width="0.9"/><path d="M10,38 Q18,36 26,38" stroke-width="0.8"/>
        <path d="M32,88 Q43,86 52,88" stroke-width="1"/><path d="M33,68 Q43,66 51,68" stroke-width="0.9"/><path d="M34,46 Q43,44 50,46" stroke-width="0.8"/>
        <path d="M57,100 Q69,98 79,100" stroke-width="1"/><path d="M58,78 Q69,76 78,78" stroke-width="0.9"/><path d="M59,55 Q69,53 77,55" stroke-width="0.8"/>
        <path d="M84,90 Q95,88 104,90" stroke-width="1"/><path d="M85,70 Q95,68 103,70" stroke-width="0.9"/><path d="M86,50 Q95,48 102,50" stroke-width="0.8"/>
        <path d="M20,134 Q60,130 96,134" stroke-width="1.2" opacity="0.5"/>
        <path d="M16,150 Q60,146 102,150" stroke-width="1" opacity="0.4"/>
        <path d="M30,124 Q48,136 44,152" stroke-width="1" opacity="0.4"/>
        <path d="M96,148 Q107,146 116,150" stroke-width="0.9"/><path d="M95,158 Q106,156 114,160" stroke-width="0.8"/>
      </g>
      <g fill="none" stroke="#e0a880" stroke-linecap="round" stroke-width="0.8" opacity="0.5">
        <path d="M9,94 Q18,92 27,94"/><path d="M31,108 Q43,106 52,108"/>
        <path d="M56,122 Q69,120 79,122"/><path d="M83,110 Q95,108 104,110"/>
      </g>
      <!-- Age spots + prominent mole (matches sketch) -->
      <g fill="#8a5030" opacity="0.25">
        <ellipse cx="38" cy="144" rx="3.5" ry="2.2"/><ellipse cx="84" cy="152" rx="2.5" ry="1.8"/>
        <ellipse cx="52" cy="158" rx="3" ry="2"/>
      </g>
      <circle cx="68" cy="132" r="4.5" fill="#7a3a18" opacity="0.55"/>
      <!-- Dark fingernails (matches sketch) -->
      <g fill="#3a2010" stroke="#1a0a04" stroke-width="0.6" opacity="0.88">
        <ellipse cx="18" cy="4" rx="7.5" ry="3.5"/>
        <ellipse cx="41" cy="2.5" rx="8" ry="3.8"/>
        <ellipse cx="67" cy="1.5" rx="8.5" ry="4"/>
        <ellipse cx="93" cy="4" rx="7.5" ry="3.5"/>
        <ellipse cx="112" cy="137" rx="5" ry="3.2" transform="rotate(35,112,137)"/>
      </g>
    </svg>

    <!-- RIGHT HAND â€” mirrored via CSS scaleX(-1) -->
    <svg id="dealer-hand-right" class="dealer-hand-svg" viewBox="0 0 110 190" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="hf-r">
          <feTurbulence type="fractalNoise" baseFrequency="0.85" numOctaves="4" result="n" seed="5"/>
          <feDisplacementMap in="SourceGraphic" in2="n" scale="1.4" xChannelSelector="R" yChannelSelector="G"/>
        </filter>
        <radialGradient id="palmG-r" cx="50%" cy="65%">
          <stop offset="0%" stop-color="#d4906a"/>
          <stop offset="100%" stop-color="#a86040"/>
        </radialGradient>
      </defs>
      <g filter="url(#hf-r)">
        <path d="M8,94 C6,70 6,44 8,18 C10,6 14,2 19,2 C24,2 28,6 29,18 C31,44 30,70 28,94 Z" fill="#c8886a"/>
        <path d="M31,108 C29,78 28,50 30,20 C31,6 37,1 43,1 C49,1 53,7 54,20 C56,50 55,78 53,108 Z" fill="#cb8e6e"/>
        <path d="M56,122 C54,88 53,56 55,20 C57,5 63,0 69,0 C75,0 79,5 81,20 C83,56 82,88 80,122 Z" fill="#c88a6a"/>
        <path d="M83,110 C81,80 80,52 82,22 C83,8 89,3 95,3 C101,3 105,9 106,22 C108,52 107,80 105,110 Z" fill="#c5866a"/>
        <path d="M8,94 C6,120 7,152 12,164 C20,176 44,182 62,182 C80,182 98,176 104,164 C109,150 110,120 105,110 C98,114 88,118 69,118 C50,118 34,114 26,108 C18,104 10,100 8,94 Z" fill="url(#palmG-r)"/>
        <path d="M104,132 C110,120 118,123 120,136 C122,150 116,166 106,170 C98,173 93,164 93,152 C93,140 97,130 104,132 Z" fill="#c5876a"/>
      </g>
      <g fill="none" stroke="#8a4e2a" stroke-linecap="round" opacity="0.65">
        <path d="M9,76 Q18,74 27,76" stroke-width="1"/><path d="M10,58 Q18,56 26,58" stroke-width="0.9"/><path d="M10,38 Q18,36 26,38" stroke-width="0.8"/>
        <path d="M32,88 Q43,86 52,88" stroke-width="1"/><path d="M33,68 Q43,66 51,68" stroke-width="0.9"/><path d="M34,46 Q43,44 50,46" stroke-width="0.8"/>
        <path d="M57,100 Q69,98 79,100" stroke-width="1"/><path d="M58,78 Q69,76 78,78" stroke-width="0.9"/><path d="M59,55 Q69,53 77,55" stroke-width="0.8"/>
        <path d="M84,90 Q95,88 104,90" stroke-width="1"/><path d="M85,70 Q95,68 103,70" stroke-width="0.9"/><path d="M86,50 Q95,48 102,50" stroke-width="0.8"/>
        <path d="M20,134 Q60,130 96,134" stroke-width="1.2" opacity="0.5"/>
        <path d="M16,150 Q60,146 102,150" stroke-width="1" opacity="0.4"/>
        <path d="M30,124 Q48,136 44,152" stroke-width="1" opacity="0.4"/>
        <path d="M96,148 Q107,146 116,150" stroke-width="0.9"/><path d="M95,158 Q106,156 114,160" stroke-width="0.8"/>
      </g>
      <g fill="none" stroke="#e0a880" stroke-linecap="round" stroke-width="0.8" opacity="0.5">
        <path d="M9,94 Q18,92 27,94"/><path d="M31,108 Q43,106 52,108"/>
        <path d="M56,122 Q69,120 79,122"/><path d="M83,110 Q95,108 104,110"/>
      </g>
      <g fill="#8a5030" opacity="0.25">
        <ellipse cx="38" cy="144" rx="3.5" ry="2.2"/><ellipse cx="52" cy="158" rx="3" ry="2"/>
      </g>
      <circle cx="58" cy="145" r="4" fill="#7a3a18" opacity="0.5"/>
      <g fill="#3a2010" stroke="#1a0a04" stroke-width="0.6" opacity="0.88">
        <ellipse cx="18" cy="4" rx="7.5" ry="3.5"/>
        <ellipse cx="41" cy="2.5" rx="8" ry="3.8"/>
        <ellipse cx="67" cy="1.5" rx="8.5" ry="4"/>
        <ellipse cx="93" cy="4" rx="7.5" ry="3.5"/>
        <ellipse cx="112" cy="137" rx="5" ry="3.2" transform="rotate(35,112,137)"/>
      </g>
    </svg>

    <!-- DIALOGUE BAR (LucasArts / point-and-click style) -->
    <div id="dialogue-bar" class="dialogue-bar">
      <div class="dialogue-portrait" id="dlg-portrait">ğŸ§‘â€ğŸ’¼</div>
      <div class="dialogue-content">
        <div class="dialogue-speaker" id="dlg-speaker">DEALER</div>
        <div class="dialogue-speech" id="dlg-speech"></div>
        <div class="dialogue-choices" id="dlg-choices"></div>
      </div>
    </div>

    <!-- HUD -->
    <div class="hud-bar">
      <div class="hud-item">
        <div class="hud-label">â˜… Balance â˜…</div>
        <div class="hud-value" id="balance-display">$500</div>
      </div>
      <div class="hud-item">
        <div class="hud-label">Hands Played</div>
        <div class="hud-value" id="hands-display">0</div>
      </div>
      <div class="hud-item">
        <div class="hud-label">W / L / P</div>
        <div class="hud-value" id="record-display">0/0/0</div>
      </div>
    </div>

    <!-- Dealer zone -->
    <div class="zone">
      <div class="zone-label">
        â™£ Dealer's Hand â™£
        <span class="hand-value" id="dealer-value">â€”</span>
      </div>
      <div class="cards" id="dealer-cards"></div>
    </div>

    <!-- Message -->
    <div class="message-area" id="message-area">
      <div class="message info">Place your bet to begin!</div>
    </div>

    <!-- Player zone -->
    <div class="zone">
      <div class="zone-label">
        â™¥ Your Hand â™¥
        <span class="hand-value" id="player-value">â€”</span>
      </div>
      <div class="cards" id="player-cards"></div>
    </div>

    <!-- Bet area -->
    <div class="bet-area" id="bet-area">
      <div class="bet-row">
        <span class="bet-label">â˜… Current Bet</span>
        <span class="current-bet" id="bet-display">$0</span>
        <button class="chip chip-clear" id="btn-clear" onclick="clearBet()">âœ• Clear</button>
      </div>
      <div class="bet-row">
        <span class="bet-label">Add Chips:</span>
        <button class="chip chip-10"  onclick="addBet(10)">$10</button>
        <button class="chip chip-25"  onclick="addBet(25)">$25</button>
        <button class="chip chip-50"  onclick="addBet(50)">$50</button>
        <button class="chip chip-100" onclick="addBet(100)">$100</button>
      </div>
    </div>

    <!-- Streak -->
    <div class="streak-row" id="streak-row">
      <span>â˜… History:</span>
      <span id="streak-dots"></span>
    </div>

    <!-- Action buttons -->
    <div class="actions" id="action-area">
      <button class="btn btn-deal" id="btn-deal" onclick="deal()">â™  Deal â™ </button>
      <button class="btn btn-hit"    id="btn-hit"    onclick="hit()"       style="display:none">Hit â–¶</button>
      <button class="btn btn-stand"  id="btn-stand"  onclick="stand()"     style="display:none">Stand â– </button>
      <button class="btn btn-double" id="btn-double" onclick="doubleDown()" style="display:none">Double â—†</button>
      <button class="btn btn-new"    id="btn-new"    onclick="newHand()"   style="display:none">â™£ New Hand â™£</button>
    </div>

  </div>

  <!-- RIGHT SIDEBAR ADS -->
  <div class="sidebar">

    <div class="fake-ad" onclick="void(0)" style="background:linear-gradient(135deg,#1a0000,#4a0000); border-color:#ff4444; box-shadow: 0 0 15px rgba(255,0,0,0.4);">
      <div class="ad-icon">ğŸ”´</div>
      <div class="ad-title" style="color:#ff4444;">ACE HIGH CASINO</div>
      <div class="ad-sub" style="color:#faa;">Las Vegas-style tables!<br>RNG certified by us!<br>Win BIG tonight!!</div>
      <div class="ad-cta">PLAY NOW</div>
    </div>

    <div class="fake-ad" onclick="void(0)">
      <div class="ad-icon">ğŸŒŸ</div>
      <div class="ad-title">ROYAL FLUSH CLUB</div>
      <div class="ad-sub">Members earn CASH BACK<br>on every hand!<br>Invite friends, earn more!</div>
      <div class="ad-cta">JOIN FREE</div>
      <div class="ad-marquee"><span class="ad-marquee-inner">CASH BACK CAPPED AT $5 â˜… SEE TERMS â˜…</span></div>
    </div>

    <div class="fake-ad" onclick="void(0)" style="background:linear-gradient(135deg,#00001a,#000033,#00001a); border-color:#6699ff; box-shadow: 0 0 15px rgba(100,150,255,0.4);">
      <div class="ad-icon">ğŸš€</div>
      <div class="ad-title" style="color:#88aaff;">GALAXY BLACKJACK</div>
      <div class="ad-sub" style="color:#aac;">Play in SPACE!<br>Crypto accepted!<br>Anonymous play!</div>
      <div class="ad-cta" style="background:linear-gradient(90deg,#003399,#0055ff,#003399);">BLAST OFF</div>
    </div>

    <div class="fake-ad" onclick="void(0)">
      <div class="ad-icon">ğŸ‘‘</div>
      <div class="ad-title">EMPEROR'S TABLE</div>
      <div class="ad-sub">$500 no-deposit bonus!<br>Bet with house money!<br>Keep what you win!</div>
      <div class="ad-cta">CLAIM BONUS</div>
      <div class="ad-marquee"><span class="ad-marquee-inner">35X wagering req. â˜… Valid 24hrs â˜… 18+ only â˜…</span></div>
    </div>

    <div class="fake-ad" onclick="void(0)" style="background:linear-gradient(135deg,#0a1a00,#1a3300); border-color:#aaff44; box-shadow: 0 0 15px rgba(170,255,68,0.3);">
      <div class="ad-icon">ğŸ€</div>
      <div class="ad-title" style="color:#aaff44;">SHAMROCK CASINO</div>
      <div class="ad-sub" style="color:#cfa;">Luck of the Irish!<br>Leprechaun jackpots<br>every Saturday!</div>
      <div class="ad-cta" style="background:linear-gradient(90deg,#226600,#44aa00,#226600);">GET LUCKY</div>
    </div>

    <div style="text-align:center; font-family:'Courier New',monospace; font-size:0.5rem; color:#444; letter-spacing:1px; padding: 4px;">
      ALL ADS ARE FICTIONAL.<br>
      FOR EDUCATIONAL USE ONLY.<br>
      BLACKJACK QUEST Â· 2024
    </div>

  </div>
</div>

<!-- BOTTOM TICKER -->
<div class="bottom-ticker">
  <span class="bottom-ticker-inner">
    âš ï¸ REMINDER: This is an educational game. No real money. â˜… The house edge in real blackjack is ~0.5% with basic strategy. â˜… Card counting is not illegal but casinos may ask you to leave. â˜… Blackjack pays 3:2 in a real casino (or 6:5 at sketchy ones, avoid those). â˜… Always split Aces and 8s. Never split 10s. â˜… Dealer must hit soft 16. â˜… Hit on soft 17 or less. Stand on hard 17+. â˜… 18+ only in real casinos. Gamble responsibly. â˜…
  </span>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SUITS  = ['â™ ','â™¥','â™¦','â™£'];
const RANKS  = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const RED    = new Set(['â™¥','â™¦']);

let balance  = 500;
let bet      = 0;
let shoe     = [];
let playerHand = [];
let dealerHand = [];
let gameState  = 'BETTING';
let stats = { w: 0, l: 0, p: 0, hands: 0 };
let history = [];
let dropCount = 0; // tracks how many times dealer has dropped cards

// â”€â”€ Story phase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 0 = hands (slow, pre-shoe offer)
// 1 = shoe offer pending
// 2 = shoe active (1 round)
// 3 = hands round 1 post-shoe (pit boss: mild)
// 4 = hands round 2 post-shoe (pit boss: angrier)
// 5 = hands round 3 post-shoe (pit boss: furious)
// 6 = Moe dealing (fast, forever)
let storyPhase = 0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DECK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildShoe(n = 6) {
  const cards = [];
  for (let d = 0; d < n; d++)
    for (const suit of SUITS)
      for (const rank of RANKS)
        cards.push({ rank, suit });
  return cards;
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function drawCard(faceUp = true) {
  if (shoe.length < 15) shoe = shuffle(buildShoe(6));
  const card = shoe.pop();
  card.faceUp = faceUp;
  return card;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HAND VALUE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function cardValue(rank) {
  if (rank === 'A') return 11;
  if (['J','Q','K'].includes(rank)) return 10;
  return parseInt(rank);
}

function handTotal(hand) {
  let total = 0, aces = 0;
  for (const c of hand) {
    if (!c.faceUp) continue;
    if (c.rank === 'A') aces++;
    total += cardValue(c.rank);
  }
  while (total > 21 && aces > 0) { total -= 10; aces--; }
  return total;
}

function isBust(hand)      { return handTotal(hand) > 21; }
function isBlackjack(hand) { return hand.length === 2 && handTotal(hand) === 21; }

function handLabel(hand) {
  const t = handTotal(hand);
  if (isBust(hand))      return { text: 'BUST', cls: 'bust' };
  if (isBlackjack(hand)) return { text: 'BJ!',  cls: 'bj'   };
  return { text: t, cls: '' };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCard(card) {
  const wrapper = document.createElement('div');
  wrapper.className = 'card-wrapper new';

  const cardEl = document.createElement('div');
  cardEl.className = 'card' + (card.faceUp ? '' : ' flipped');

  const color = RED.has(card.suit) ? 'red' : 'black';

  const front = document.createElement('div');
  front.className = `card-face ${color}`;
  front.innerHTML = `
    <div class="corner tl"><span>${card.rank}</span><span>${card.suit}</span></div>
    <div class="center-suit">${card.suit}</div>
    <div class="corner br"><span>${card.rank}</span><span>${card.suit}</span></div>
  `;

  const back = document.createElement('div');
  back.className = 'card-back-face';
  back.textContent = 'ğŸ‚ ';

  cardEl.appendChild(front);
  cardEl.appendChild(back);
  wrapper.appendChild(cardEl);
  return wrapper;
}

function renderHand(containerId, hand, revealAll = false) {
  const el = document.getElementById(containerId);
  el.innerHTML = '';
  hand.forEach(card => {
    const display = revealAll ? { ...card, faceUp: true } : card;
    el.appendChild(renderCard(display));
  });
}

function updateValues() {
  const pv = document.getElementById('player-value');
  if (playerHand.length === 0) { pv.textContent = 'â€”'; pv.className = 'hand-value'; }
  else {
    const pl = handLabel(playerHand);
    pv.textContent = pl.text;
    pv.className = 'hand-value ' + pl.cls;
  }

  const dv = document.getElementById('dealer-value');
  const vis = dealerHand.filter(c => c.faceUp);
  if (vis.length === 0) { dv.textContent = 'â€”'; dv.className = 'hand-value'; }
  else {
    if (gameState === 'RESULT') {
      const dl = handLabel(dealerHand.map(c => ({ ...c, faceUp: true })));
      dv.textContent = dl.text;
      dv.className = 'hand-value ' + dl.cls;
    } else {
      dv.textContent = handTotal(vis);
      dv.className = 'hand-value';
    }
  }
}

function showMessage(text, type) {
  const area = document.getElementById('message-area');
  area.innerHTML = '';
  if (!text) return;
  const m = document.createElement('div');
  m.className = `message ${type}`;
  m.textContent = text;
  area.appendChild(m);
}

function updateHUD() {
  document.getElementById('balance-display').textContent = `$${balance}`;
  document.getElementById('bet-display').textContent = `$${bet}`;
  document.getElementById('hands-display').textContent = stats.hands;
  document.getElementById('record-display').textContent = `${stats.w}/${stats.l}/${stats.p}`;
}

function updateStreak() {
  const dots = document.getElementById('streak-dots');
  dots.innerHTML = '';
  history.slice(-12).forEach(o => {
    const d = document.createElement('span');
    d.className = `streak-dot ${o}`;
    dots.appendChild(d);
  });
}

function setButtons(state) {
  const deal   = document.getElementById('btn-deal');
  const hit    = document.getElementById('btn-hit');
  const stand  = document.getElementById('btn-stand');
  const dbl    = document.getElementById('btn-double');
  const newH   = document.getElementById('btn-new');
  const chips  = document.querySelectorAll('.chip');
  const betArea= document.getElementById('bet-area');

  deal.style.display  = state === 'BETTING'     ? '' : 'none';
  hit.style.display   = state === 'PLAYER_TURN' ? '' : 'none';
  stand.style.display = state === 'PLAYER_TURN' ? '' : 'none';
  dbl.style.display   = state === 'PLAYER_TURN' ? '' : 'none';
  newH.style.display  = state === 'RESULT'      ? '' : 'none';

  if (state === 'PLAYER_TURN') dbl.disabled = playerHand.length !== 2 || balance < bet;
  if (state === 'BETTING') {
    deal.disabled = bet === 0;
    chips.forEach(c => c.disabled = false);
    betArea.style.display = '';
  } else {
    chips.forEach(c => c.disabled = true);
    betArea.style.display = state === 'RESULT' ? '' : 'none';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addBet(amount) {
  if (gameState !== 'BETTING') return;
  const toAdd = Math.min(amount, balance - bet);
  if (toAdd <= 0) return;
  bet += toAdd;
  updateHUD();
  setButtons('BETTING');
}

function clearBet() {
  if (gameState !== 'BETTING') return;
  bet = 0;
  updateHUD();
  setButtons('BETTING');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHARACTER PORTRAITS (SVG)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GARY_NORMAL = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 56" width="44" height="56" style="display:block">
  <path d="M9,50 Q11,54 16,56 L22,53 L28,56 Q33,54 35,50 Q26,53.5 22,53 Q18,53.5 9,50Z" fill="#ccc" stroke="#888" stroke-width="0.7"/>
  <line x1="16" y1="52" x2="14" y2="56" stroke="#aaa" stroke-width="0.6"/>
  <line x1="28" y1="52" x2="30" y2="56" stroke="#aaa" stroke-width="0.6"/>
  <rect x="18" y="46" width="8" height="6" rx="2" fill="#f0cca8"/>
  <path d="M5,25 Q1,29 4,34 Q7,33 6.5,30 Q7,27 5,25Z" fill="#f0d0b0" stroke="#2a1808" stroke-width="0.9"/>
  <path d="M4.5,27 Q3,30 4.5,33" fill="none" stroke="#b08060" stroke-width="0.5" opacity="0.7"/>
  <path d="M39,25 Q43,29 40,34 Q37,33 37.5,30 Q37,27 39,25Z" fill="#f0d0b0" stroke="#2a1808" stroke-width="0.9"/>
  <path d="M39.5,27 Q41,30 39.5,33" fill="none" stroke="#b08060" stroke-width="0.5" opacity="0.7"/>
  <ellipse cx="22" cy="26" rx="17" ry="20" fill="#f4d8b8" stroke="#2a1808" stroke-width="1.1"/>
  <path d="M10,12 Q12,8 15.5,10" fill="none" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <path d="M14,10 Q17,7 20,9" fill="none" stroke="#2a1808" stroke-width="1.2" stroke-linecap="round"/>
  <path d="M24,9 Q27,7 30,10" fill="none" stroke="#2a1808" stroke-width="1.2" stroke-linecap="round"/>
  <path d="M32,12 Q30,8 28.5,10" fill="none" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <path d="M13,19 Q22,18 31,19" fill="none" stroke="#b08858" stroke-width="0.45" opacity="0.55"/>
  <circle cx="17" cy="15" r="0.9" fill="#7a4828"/>
  <path d="M10,23 Q13.5,21.5 17,23" fill="none" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <path d="M27,22 Q30,22.5 33,24" fill="none" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <circle cx="15.5" cy="29" r="7" fill="rgba(210,230,245,0.08)" stroke="#111" stroke-width="1.9"/>
  <circle cx="28.5" cy="29" r="7" fill="rgba(210,230,245,0.08)" stroke="#111" stroke-width="1.9"/>
  <line x1="22.5" y1="29" x2="21.5" y2="29" stroke="#111" stroke-width="1.6"/>
  <line x1="7" y1="28" x2="8.5" y2="28.5" stroke="#111" stroke-width="1.5"/>
  <line x1="37" y1="28" x2="35.5" y2="28.5" stroke="#111" stroke-width="1.5"/>
  <ellipse cx="15.5" cy="29" rx="4" ry="4.2" fill="white"/>
  <circle cx="15.8" cy="29.5" r="2.5" fill="#1e1008"/>
  <circle cx="16.7" cy="28.6" r="0.7" fill="white"/>
  <ellipse cx="28.5" cy="29" rx="4" ry="4.2" fill="white"/>
  <circle cx="28.8" cy="29.5" r="2.5" fill="#1e1008"/>
  <circle cx="29.7" cy="28.6" r="0.7" fill="white"/>
  <path d="M21,34 Q19.5,36.5 19,38.5 Q22,40 25,38.5 Q24.5,36.5 23,34" fill="#ecc8a0" fill-opacity="0.65" stroke="#b08860" stroke-width="0.5"/>
  <path d="M14,43 Q22,48 30,43" fill="none" stroke="#2a1808" stroke-width="1.2" stroke-linecap="round"/>
  <path d="M15,43.5 Q22,47.5 29,43.5" fill="#f0e8e0"/>
  <path d="M8,36 Q6,41 10,45.5" fill="none" stroke="#c0a078" stroke-width="0.5" opacity="0.38"/>
  <path d="M36,36 Q38,41 34,45.5" fill="none" stroke="#c0a078" stroke-width="0.5" opacity="0.38"/>
</svg>`;

const GARY_ALT = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 56" width="44" height="56" style="display:block">
  <path d="M9,50 Q11,54 16,56 L22,53 L28,56 Q33,54 35,50 Q26,53.5 22,53 Q18,53.5 9,50Z" fill="#ccc" stroke="#888" stroke-width="0.7"/>
  <line x1="16" y1="52" x2="14" y2="56" stroke="#aaa" stroke-width="0.6"/>
  <line x1="28" y1="52" x2="30" y2="56" stroke="#aaa" stroke-width="0.6"/>
  <rect x="18" y="46" width="8" height="6" rx="2" fill="#f0cca8"/>
  <path d="M5,25 Q1,29 4,34 Q7,33 6.5,30 Q7,27 5,25Z" fill="#f0d0b0" stroke="#2a1808" stroke-width="0.9"/>
  <path d="M39,25 Q43,29 40,34 Q37,33 37.5,30 Q37,27 39,25Z" fill="#f0d0b0" stroke="#2a1808" stroke-width="0.9"/>
  <ellipse cx="22" cy="26" rx="17" ry="20" fill="#f4d8b8" stroke="#2a1808" stroke-width="1.1"/>
  <path d="M10,12 Q12,8 15.5,10" fill="none" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <path d="M14,10 Q17,7 20,9" fill="none" stroke="#2a1808" stroke-width="1.2" stroke-linecap="round"/>
  <path d="M24,9 Q27,7 30,10" fill="none" stroke="#2a1808" stroke-width="1.2" stroke-linecap="round"/>
  <path d="M32,12 Q30,8 28.5,10" fill="none" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <path d="M13,17 Q22,15.5 31,17" fill="none" stroke="#b08858" stroke-width="0.5" opacity="0.65"/>
  <path d="M14,20 Q22,18.5 30,20" fill="none" stroke="#b08858" stroke-width="0.4" opacity="0.5"/>
  <circle cx="17" cy="15" r="0.9" fill="#7a4828"/>
  <path d="M36,9 Q37.5,7 39,9 Q38,12 36,9Z" fill="#aad4f0" opacity="0.8"/>
  <path d="M10,21 Q13.5,19 17,21.5" fill="none" stroke="#2a1808" stroke-width="1.6" stroke-linecap="round"/>
  <path d="M27,20 Q30,19.5 33,22" fill="none" stroke="#2a1808" stroke-width="1.6" stroke-linecap="round"/>
  <circle cx="15.5" cy="29" r="7" fill="rgba(210,230,245,0.08)" stroke="#111" stroke-width="1.9"/>
  <circle cx="28.5" cy="29" r="7" fill="rgba(210,230,245,0.08)" stroke="#111" stroke-width="1.9"/>
  <line x1="22.5" y1="29" x2="21.5" y2="29" stroke="#111" stroke-width="1.6"/>
  <line x1="7" y1="28" x2="8.5" y2="28.5" stroke="#111" stroke-width="1.5"/>
  <line x1="37" y1="28" x2="35.5" y2="28.5" stroke="#111" stroke-width="1.5"/>
  <ellipse cx="15.5" cy="29" rx="4.3" ry="4.6" fill="white"/>
  <circle cx="15.8" cy="29.3" r="2.5" fill="#1e1008"/>
  <circle cx="16.7" cy="28.4" r="0.7" fill="white"/>
  <ellipse cx="28.5" cy="29" rx="4.3" ry="4.6" fill="white"/>
  <circle cx="28.8" cy="29.3" r="2.5" fill="#1e1008"/>
  <circle cx="29.7" cy="28.4" r="0.7" fill="white"/>
  <path d="M21,34 Q19.5,36.5 19,38.5 Q22,40 25,38.5 Q24.5,36.5 23,34" fill="#ecc8a0" fill-opacity="0.65" stroke="#b08860" stroke-width="0.5"/>
  <path d="M14.5,43 Q18,46 22,44.5 Q26,43 29.5,45" fill="none" stroke="#2a1808" stroke-width="1.3" stroke-linecap="round"/>
  <path d="M15.5,43.5 Q22,46 28.5,44.5" fill="#f0e8e0"/>
  <path d="M7.5,36 Q5.5,42 9.5,46" fill="none" stroke="#c0a078" stroke-width="0.55" opacity="0.45"/>
  <path d="M36.5,36 Q38.5,42 34.5,46" fill="none" stroke="#c0a078" stroke-width="0.55" opacity="0.45"/>
</svg>`;

const PITBOSS_NORMAL = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 56" width="44" height="56" style="display:block">
  <!-- Top hat (tall, flat-topped, black) -->
  <rect x="10" y="0" width="24" height="13" fill="#111" rx="0.5"/>
  <rect x="10" y="11" width="24" height="2.5" fill="#2a2a2a"/>
  <rect x="6" y="12" width="32" height="3" rx="0.5" fill="#111"/>
  <!-- Face (strong jaw) -->
  <path d="M9,16 Q9,14 22,14 Q35,14 35,16 L36,35 Q35,44 22,46 Q9,44 8,35 Z" fill="#f0d0a8" stroke="#2a1808" stroke-width="1.1"/>
  <!-- Ears -->
  <path d="M7,22 Q3,26 6,31 Q9,30 8.5,27 Q8.5,24 7,22Z" fill="#ecc8a0" stroke="#2a1808" stroke-width="0.9"/>
  <path d="M37,22 Q41,26 38,31 Q35,30 35.5,27 Q35.5,24 37,22Z" fill="#ecc8a0" stroke="#2a1808" stroke-width="0.9"/>
  <!-- Hair at temples (dark, under hat) -->
  <path d="M9.5,16.5 Q8,19 9,22" fill="none" stroke="#111" stroke-width="2.8" stroke-linecap="round"/>
  <path d="M34.5,16.5 Q36,19 35,22" fill="none" stroke="#111" stroke-width="2.8" stroke-linecap="round"/>
  <!-- THICK dramatic eyebrows (slope inward/downward â€” intimidating) -->
  <path d="M9,23 Q14,20.5 19,22.5" fill="none" stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
  <path d="M25,22.5 Q30,20.5 35,23" fill="none" stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
  <path d="M20,23 Q22,21.5 24,23" fill="none" stroke="#a08858" stroke-width="0.7" opacity="0.8"/>
  <!-- Eyes (half-lidded, mean) -->
  <ellipse cx="15.5" cy="28" rx="4" ry="2.8" fill="white"/>
  <circle cx="15.8" cy="28.2" r="1.9" fill="#0a0808"/>
  <path d="M11.5,26.5 Q15.5,25.3 19.5,26.5" fill="#f0d0a8" stroke="#2a1808" stroke-width="0.95"/>
  <ellipse cx="28.5" cy="28" rx="4" ry="2.8" fill="white"/>
  <circle cx="28.8" cy="28.2" r="1.9" fill="#0a0808"/>
  <path d="M24.5,26.5 Q28.5,25.3 32.5,26.5" fill="#f0d0a8" stroke="#2a1808" stroke-width="0.95"/>
  <!-- Nose (strong, broad) -->
  <path d="M21,32 Q19.5,34.5 19,36 Q22,37.5 25,36 Q24.5,34.5 23,32" fill="#e0b890" fill-opacity="0.6" stroke="#b08060" stroke-width="0.5"/>
  <!-- Cigar (from mouth, angling down-right, smoke rising) -->
  <rect x="16" y="41" width="17" height="2.6" rx="1.3" fill="#8a5828" transform="rotate(-10,16,41)"/>
  <rect x="22" y="41" width="3" height="2.6" fill="#c8a040" opacity="0.65" transform="rotate(-10,22,41)"/>
  <ellipse cx="32" cy="39.5" rx="2.2" ry="1.4" fill="#c04010" opacity="0.9" transform="rotate(-10,32,39.5)"/>
  <path d="M33,38 Q35,35 34,32 Q36,29 35,27" fill="none" stroke="#ccc" stroke-width="1.1" stroke-linecap="round" opacity="0.5"/>
  <path d="M13,42 Q15,43.5 16.5,42.5" fill="none" stroke="#2a1808" stroke-width="0.9" stroke-linecap="round"/>
  <!-- Plain collar (no ruff â€” just a dark neckband) -->
  <path d="M9,46 Q11,52 16,56 L22,54 L28,56 Q33,52 35,46 Q26,49 22,49 Q18,49 9,46Z" fill="#222" stroke="#111" stroke-width="0.7"/>
  <line x1="19" y1="50" x2="18" y2="56" stroke="#333" stroke-width="0.8"/>
  <line x1="25" y1="50" x2="26" y2="56" stroke="#333" stroke-width="0.8"/>
</svg>`;

const PITBOSS_ALT = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 56" width="44" height="56" style="display:block">
  <rect x="10" y="0" width="24" height="13" fill="#111" rx="0.5"/>
  <rect x="10" y="11" width="24" height="2.5" fill="#2a2a2a"/>
  <rect x="6" y="12" width="32" height="3" rx="0.5" fill="#111"/>
  <!-- Face slightly flushed (furious) -->
  <path d="M9,16 Q9,14 22,14 Q35,14 35,16 L36,35 Q35,44 22,46 Q9,44 8,35 Z" fill="#e8b8a0" stroke="#2a1808" stroke-width="1.1"/>
  <path d="M7,22 Q3,26 6,31 Q9,30 8.5,27 Q8.5,24 7,22Z" fill="#e0b09a" stroke="#2a1808" stroke-width="0.9"/>
  <path d="M37,22 Q41,26 38,31 Q35,30 35.5,27 Q35.5,24 37,22Z" fill="#e0b09a" stroke="#2a1808" stroke-width="0.9"/>
  <path d="M9.5,16.5 Q8,19 9,22" fill="none" stroke="#111" stroke-width="2.8" stroke-linecap="round"/>
  <path d="M34.5,16.5 Q36,19 35,22" fill="none" stroke="#111" stroke-width="2.8" stroke-linecap="round"/>
  <!-- More extreme brows (furious) -->
  <path d="M9,21.5 Q14,19 19,22" fill="none" stroke="#111" stroke-width="4" stroke-linecap="round"/>
  <path d="M25,22 Q30,19 35,21.5" fill="none" stroke="#111" stroke-width="4" stroke-linecap="round"/>
  <path d="M19.5,22.5 Q22,20.5 24.5,22.5" fill="none" stroke="#8a6040" stroke-width="0.9" opacity="0.9"/>
  <!-- Eyes (squinting hard) -->
  <ellipse cx="15.5" cy="28.5" rx="4" ry="2.2" fill="white"/>
  <circle cx="15.8" cy="28.6" r="1.9" fill="#0a0808"/>
  <path d="M11.5,27 Q15.5,25.5 19.5,27" fill="#e8b8a0" stroke="#2a1808" stroke-width="1.1"/>
  <ellipse cx="28.5" cy="28.5" rx="4" ry="2.2" fill="white"/>
  <circle cx="28.8" cy="28.6" r="1.9" fill="#0a0808"/>
  <path d="M24.5,27 Q28.5,25.5 32.5,27" fill="#e8b8a0" stroke="#2a1808" stroke-width="1.1"/>
  <path d="M21,32 Q19.5,34.5 19,36 Q22,37.5 25,36 Q24.5,34.5 23,32" fill="#e0b890" fill-opacity="0.6" stroke="#b08060" stroke-width="0.5"/>
  <!-- Cigar (clenched harder, same angle) -->
  <rect x="16" y="41" width="17" height="2.6" rx="1.3" fill="#8a5828" transform="rotate(-10,16,41)"/>
  <rect x="22" y="41" width="3" height="2.6" fill="#c8a040" opacity="0.65" transform="rotate(-10,22,41)"/>
  <ellipse cx="32" cy="39.5" rx="2.2" ry="1.4" fill="#e04010" opacity="0.95" transform="rotate(-10,32,39.5)"/>
  <path d="M33,38 Q35,35 34,32 Q36,29 35,27" fill="none" stroke="#ccc" stroke-width="1.3" stroke-linecap="round" opacity="0.6"/>
  <path d="M13,42 Q15,43.5 16.5,42.5" fill="none" stroke="#2a1808" stroke-width="0.9" stroke-linecap="round"/>
  <!-- Anger lines at temples -->
  <path d="M6,20 L8,23" stroke="#cc6040" stroke-width="1" stroke-linecap="round" opacity="0.6"/>
  <path d="M38,20 L36,23" stroke="#cc6040" stroke-width="1" stroke-linecap="round" opacity="0.6"/>
  <path d="M9,46 Q11,52 16,56 L22,54 L28,56 Q33,52 35,46 Q26,49 22,49 Q18,49 9,46Z" fill="#222" stroke="#111" stroke-width="0.7"/>
  <line x1="19" y1="50" x2="18" y2="56" stroke="#333" stroke-width="0.8"/>
  <line x1="25" y1="50" x2="26" y2="56" stroke="#333" stroke-width="0.8"/>
</svg>`;

const MOE_PORTRAIT = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 56" width="44" height="56" style="display:block">
  <!-- Sparse hair (3 strands sticking straight up) -->
  <line x1="18" y1="9" x2="16" y2="3" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="22" y1="8" x2="21.5" y2="2" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="26" y1="9" x2="28.5" y2="3" stroke="#2a1808" stroke-width="1.5" stroke-linecap="round"/>
  <!-- Body (rounded blob â€” shirtless, head+torso merged) -->
  <path d="M22,8 Q34,9 37,18 Q41,28 38,38 Q36,46 30,50 Q26,53 22,53 Q18,53 14,50 Q8,46 6,38 Q3,28 7,18 Q10,9 22,8 Z" fill="white" stroke="#2a1808" stroke-width="1.3"/>
  <!-- Stub arms -->
  <path d="M6.5,36 Q0,33 2,27 Q4,24 7,28" fill="white" stroke="#2a1808" stroke-width="1.1"/>
  <path d="M37.5,36 Q44,33 42,27 Q40,24 37,28" fill="white" stroke="#2a1808" stroke-width="1.1"/>
  <!-- Eyes (big round circles) -->
  <circle cx="15" cy="20" r="5.5" fill="white" stroke="#2a1808" stroke-width="1.3"/>
  <circle cx="15" cy="20" r="3" fill="#111"/>
  <circle cx="16.4" cy="18.6" r="0.85" fill="white"/>
  <circle cx="29" cy="20" r="5.5" fill="white" stroke="#2a1808" stroke-width="1.3"/>
  <circle cx="29" cy="20" r="3" fill="#111"/>
  <circle cx="30.4" cy="18.6" r="0.85" fill="white"/>
  <!-- Two dot nose -->
  <circle cx="20.5" cy="29" r="1.1" fill="#2a1808" opacity="0.75"/>
  <circle cx="23.5" cy="29" r="1.1" fill="#2a1808" opacity="0.75"/>
  <!-- Pencil mustache -->
  <path d="M17.5,33 Q22,32 26.5,33" fill="none" stroke="#2a1808" stroke-width="1.4" stroke-linecap="round"/>
  <!-- Mouth (straight horizontal line) -->
  <line x1="18" y1="37" x2="26" y2="37" stroke="#2a1808" stroke-width="1.2" stroke-linecap="round"/>
</svg>`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHARACTER DEFINITIONS  (add new characters here)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHARS = {
  dealer:  { name: 'Gary  (Dealer)', portrait: GARY_NORMAL,    portraitAlt: GARY_ALT     },
  pitBoss: { name: 'Pit Boss',       portrait: PITBOSS_NORMAL, portraitAlt: PITBOSS_ALT  },
  moe:     { name: 'Moe',            portrait: MOE_PORTRAIT,   portraitAlt: MOE_PORTRAIT },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DIALOGUE SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showDialogue(char, speech, choices = []) {
  const bar   = document.getElementById('dialogue-bar');
  const port  = document.getElementById('dlg-portrait');
  const spkr  = document.getElementById('dlg-speaker');
  const spch  = document.getElementById('dlg-speech');
  const chEl  = document.getElementById('dlg-choices');

  port.innerHTML    = char.portrait;
  spkr.textContent  = char.name;
  spch.innerHTML    = speech;
  chEl.innerHTML    = '';

  choices.forEach(({ label, cb }) => {
    const btn = document.createElement('button');
    btn.className   = 'dialogue-choice';
    btn.textContent = label;
    btn.onclick = () => { hideDialogue(); cb(); };
    chEl.appendChild(btn);
  });

  bar.classList.add('visible');
}

function showDialogueAlt(char, speech, choices = []) {
  // Same as showDialogue but uses the alt portrait (e.g. distressed face)
  showDialogue({ ...char, portrait: char.portraitAlt }, speech, choices);
}

function hideDialogue() {
  document.getElementById('dialogue-bar').classList.remove('visible');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEALER HAND ANIMATION (two hands)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handIn() {
  if (storyPhase === 2 || storyPhase >= 6) return; // no hands in shoe/Moe mode
  document.getElementById('dealer-hand-left').classList.add('dealing');
  document.getElementById('dealer-hand-right').classList.add('dealing');
}
function handOut() {
  document.getElementById('dealer-hand-left').classList.remove('dealing');
  document.getElementById('dealer-hand-right').classList.remove('dealing');
}

// Deal stagger speed: slow (hands), normal (shoe), lightning (Moe)
function dealStagger() {
  if (storyPhase === 2) return 380;
  if (storyPhase >= 6)  return 55;
  return 900;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SHUFFLE + DROP SEQUENCES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function runShuffle(onDone) {
  if (storyPhase >= 6) {
    // Moe: no dialogue, instant
    setTimeout(onDone, 120);
    return;
  }
  if (storyPhase === 2) {
    // Shoe: brisk professional shuffle
    showDialogue(CHARS.dealer, '"Okay â€” shoe, shoe, shoeâ€”"');
    setTimeout(() => { hideDialogue(); onDone(); }, 750);
    return;
  }
  // Hands mode: painfully slow
  const fumbles = [
    '"Just... one second... they keep slipping..."',
    '"Hold on... almost... got... them..."',
    '"Right, okay. I can do this. I can do... this."',
    '"Sorry, these are very... glossy cards."',
    '"Oh â€” dropped one. And another. That\'s fine."',
  ];
  const line = fumbles[Math.floor(Math.random() * fumbles.length)];
  showDialogueAlt(CHARS.dealer, line);
  handIn();
  setTimeout(() => { hideDialogue(); onDone(); }, 1900);
}

function deal() {
  if (bet === 0 || gameState !== 'BETTING') return;
  document.getElementById('btn-deal').disabled = true;
  document.querySelectorAll('.chip').forEach(c => c.disabled = true);

  checkPreDealNarrative(() => {
    const canDrop = storyPhase !== 2 && storyPhase < 6;
    const DROPPED = canDrop && Math.random() < 0.35;
    if (DROPPED) {
      dropCount++;
      runDropSequence(dropCount, () => runShuffle(doDeal));
    } else {
      runShuffle(doDeal);
    }
  });
}

function runDropSequence(count, onDone) {
  // Phase 1 (auto, 2.2s): dealer drops the cards
  showDialogueAlt(CHARS.dealer, '"Oh shoot. I dropped them again.&nbsp; Sorry, I\'m new here. Heh. Lawyer bills!"');

  setTimeout(() => {
    hideDialogue();

    if (count === 1) {
      showDialogueAlt(CHARS.dealer,
        '"...*sigh*&nbsp; I miss you, Sharon."',
        [{ label: 'Respond Politely', cb: onDone }]
      );
    } else if (count === 2) {
      showDialogueAlt(CHARS.dealer,
        '"You know, it gets tough working here. The bosses... they don\'t play!"',
        [{ label: 'Respond Politely', cb: onDone }]
      );
    } else {
      showDialogueAlt(CHARS.dealer,
        '"You ever go through a divor-?"',
        [{ label: 'Just shuffle the cards, man.', cb: onDone }]
      );
    }
  }, 2200);
}

// Helper: append a single card to a container
function appendCard(containerId, card) {
  document.getElementById(containerId).appendChild(renderCard(card));
}

function doDeal() {
  balance -= bet;
  playerHand = [drawCard(true), drawCard(true)];
  dealerHand = [drawCard(true), drawCard(false)];
  gameState = 'PLAYER_TURN';
  stats.hands++;

  // Clear both hands
  document.getElementById('dealer-cards').innerHTML = '';
  document.getElementById('player-cards').innerHTML = '';
  showMessage('', '');
  updateHUD();

  // Deal 4 cards alternating dealer/player, staggered â€” hand already visible from runShuffle()
  const sequence = [
    { card: dealerHand[0], id: 'dealer-cards' },
    { card: playerHand[0], id: 'player-cards' },
    { card: dealerHand[1], id: 'dealer-cards' },
    { card: playerHand[1], id: 'player-cards' },
  ];
  const stagger = dealStagger();
  sequence.forEach(({ card, id }, i) => {
    setTimeout(() => {
      appendCard(id, card);
      updateValues();
    }, i * stagger);
  });

  const totalDealTime = sequence.length * stagger + 200;
  setTimeout(() => {
    handOut();
    setButtons('PLAYER_TURN');
    const playerBJ = isBlackjack(playerHand);
    const dealerBJ = isBlackjack(dealerHand.map(c => ({ ...c, faceUp: true })));
    if (playerBJ || dealerBJ) {
      dealerHand = dealerHand.map(c => ({ ...c, faceUp: true }));
      renderHand('dealer-cards', dealerHand, true);
      updateValues();
      settleResult(playerBJ && dealerBJ ? 'push' : playerBJ ? 'blackjack' : 'lose');
    }
  }, totalDealTime);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PLAYER ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function hit() {
  if (gameState !== 'PLAYER_TURN') return;
  playerHand.push(drawCard(true));
  renderHand('player-cards', playerHand);
  updateValues();
  if (isBust(playerHand)) settleResult('lose');
  else if (handTotal(playerHand) === 21) stand();
  else setButtons('PLAYER_TURN');
}

function stand() {
  if (gameState !== 'PLAYER_TURN') return;
  gameState = 'DEALER_TURN';
  setButtons('DEALER_TURN');
  runDealer();
}

function doubleDown() {
  if (gameState !== 'PLAYER_TURN' || playerHand.length !== 2 || balance < bet) return;
  balance -= bet;
  bet *= 2;
  updateHUD();
  playerHand.push(drawCard(true));
  renderHand('player-cards', playerHand);
  updateValues();
  if (isBust(playerHand)) settleResult('lose');
  else { gameState = 'DEALER_TURN'; setButtons('DEALER_TURN'); runDealer(); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEALER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function runDealer() {
  dealerHand = dealerHand.map(c => ({ ...c, faceUp: true }));
  renderHand('dealer-cards', dealerHand, true);
  updateValues();

  function step() {
    let total = 0, aces = 0;
    for (const c of dealerHand) {
      if (c.rank === 'A') aces++;
      total += cardValue(c.rank);
    }
    while (total > 21 && aces > 0) { total -= 10; aces--; }
    if (total >= 17) { resolveHands(); return; }
    dealerHand.push(drawCard(true));
    renderHand('dealer-cards', dealerHand, true);
    updateValues();
    setTimeout(step, 450);
  }
  setTimeout(step, 550);
}

function resolveHands() {
  const p = handTotal(playerHand);
  const d = handTotal(dealerHand);
  if (isBust(dealerHand))  settleResult('win');
  else if (p > d)          settleResult('win');
  else if (p < d)          settleResult('lose');
  else                     settleResult('push');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function settleResult(outcome) {
  gameState = 'RESULT';
  let msg, type, dot;
  switch (outcome) {
    case 'blackjack':
      balance += Math.floor(bet * 2.5);
      msg = `â™  BLACKJACK! +$${Math.floor(bet * 1.5)}`; type = 'win'; dot = 'w'; stats.w++; break;
    case 'win':
      balance += bet * 2;
      msg = `âœ“ YOU WIN! +$${bet}`; type = 'win'; dot = 'w'; stats.w++; break;
    case 'push':
      balance += bet;
      msg = 'â€” PUSH â€” BET RETURNED'; type = 'push'; dot = 'p'; stats.p++; break;
    case 'lose':
      msg = isBust(playerHand) ? `âœ• BUST! -$${bet}` : `âœ• DEALER WINS -$${bet}`;
      type = 'lose'; dot = 'l'; stats.l++; break;
  }
  history.push(dot);
  showMessage(msg, type);
  updateHUD();
  updateStreak();
  setButtons('RESULT');
  if (balance <= 0) setTimeout(showGameOver, 1400);
  else checkPostResultNarrative();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NEW HAND / GAME OVER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function newHand() {
  playerHand = []; dealerHand = []; bet = 0; gameState = 'BETTING';
  document.getElementById('player-cards').innerHTML = '';
  document.getElementById('dealer-cards').innerHTML = '';
  document.getElementById('player-value').textContent = 'â€”';
  document.getElementById('player-value').className = 'hand-value';
  document.getElementById('dealer-value').textContent = 'â€”';
  document.getElementById('dealer-value').className = 'hand-value';
  showMessage('', '');
  hideDialogue();
  handOut();
  updateHUD();
  setButtons('BETTING');
}

function showGameOver() {
  const o = document.createElement('div');
  o.className = 'game-over-overlay';
  o.innerHTML = `
    <div class="game-over-title">â˜… BROKE! â˜…</div>
    <div class="game-over-sub">${stats.hands} HANDS Â· ${stats.w}W / ${stats.l}L / ${stats.p}P</div>
    <div style="color:#cc9900;font-family:'Courier New',monospace;font-size:0.65rem;text-align:center;letter-spacing:1px;max-width:300px;">Perhaps check out one of our AMAZING partner casinos to win it all back?</div>
    <button class="btn btn-deal" onclick="restartGame()" style="font-size:1.1rem;padding:14px 40px">â™  PLAY AGAIN â™ </button>
  `;
  document.body.appendChild(o);
}

function restartGame() {
  document.querySelector('.game-over-overlay')?.remove();
  balance = 500; bet = 0; stats = { w:0,l:0,p:0,hands:0 }; history = []; dropCount = 0;
  storyPhase = 0;
  playerHand = []; dealerHand = []; gameState = 'BETTING';
  shoe = shuffle(buildShoe(6));
  document.getElementById('player-cards').innerHTML = '';
  document.getElementById('dealer-cards').innerHTML = '';
  document.getElementById('player-value').textContent = 'â€”';
  document.getElementById('dealer-value').textContent = 'â€”';
  showMessage('Place your bet to begin!', 'info');
  updateHUD(); updateStreak(); setButtons('BETTING');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NARRATIVE ARC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Fires BEFORE each deal; may intercept with pit boss dialogue.
function checkPreDealNarrative(proceed) {
  if (storyPhase === 3) {
    showDialogue(CHARS.pitBoss,
      '"Gary."',
      [{ label: '(Gary shuffles)', cb: proceed }]
    );
  } else if (storyPhase === 4) {
    showDialogue(CHARS.pitBoss,
      '"GARY. I\'m watching you."',
      [{ label: '(Silence)', cb: proceed }]
    );
  } else if (storyPhase === 5) {
    showDialogue(CHARS.pitBoss,
      '"Gary, this is your last chance. Those cards had better move."',
      [{ label: '(Gary shuffles. Slower than usual.)', cb: proceed }]
    );
  } else {
    proceed();
  }
}

// Fires AFTER each result settles.
function checkPostResultNarrative() {
  if (storyPhase === 0 && stats.hands >= 1) {
    // After first hand: Gary apologises, player can suggest shoe
    storyPhase = 1;
    setTimeout(() => {
      showDialogueAlt(CHARS.dealer,
        '"Phew. Sorry about the... speed of that. Sweaty palms. Occupational hazard."',
        [
          { label: 'Have you considered a shoe?', cb: runShoeOffer },
          { label: 'It was fine, Gary.',           cb: () => {
            showDialogue(CHARS.dealer,
              '"Oh, that\'s... thanks. Actually â€” hold on. I think there\'s a shoe around here somewhere."',
              [{ label: '(He goes to get it anyway)', cb: runShoeOffer }]
            );
          }}
        ]
      );
    }, 1400);
  } else if (storyPhase === 2) {
    // Shoe round done â€” it breaks
    storyPhase = 3;
    setTimeout(() => {
      showDialogue(CHARS.dealer,
        '"See? Smooth. That\'s called professionalism. I am a professional. That went reallyâ€”"',
        [{ label: '...what was that sound?', cb: () => {
          showDialogueAlt(CHARS.dealer,
            '"[CRACK]<br>...The shoe.<br>It broke."',
            [{ label: 'Of course it did.', cb: hideDialogue }]
          );
        }}]
      );
    }, 1400);
  } else if (storyPhase === 3) {
    storyPhase = 4;
  } else if (storyPhase === 4) {
    storyPhase = 5;
  } else if (storyPhase === 5) {
    storyPhase = 6;
    setTimeout(runMoeEntrance, 1600);
  }
}

function runShoeOffer() {
  hideDialogue();
  setTimeout(() => {
    showDialogue(CHARS.dealer,
      '"Found it! Okay! This is a shoe. Professional casino equipment. Much better."',
      [{ label: 'Let\'s see it.', cb: () => { storyPhase = 2; hideDialogue(); } }]
    );
  }, 2200);
}

function runMoeEntrance() {
  showDialogue(CHARS.pitBoss,
    '"THAT\'S IT.&nbsp; MOE!!!"',
    [{ label: '(A distant clattering)', cb: () => {
      setTimeout(() => {
        showDialogue(CHARS.moe,
          '"[Moe has climbed onto the table. He is already dealing.]"',
          [{ label: 'Okay.', cb: hideDialogue }]
        );
      }, 900);
    }}]
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
shoe = shuffle(buildShoe(6));
updateHUD();
setButtons('BETTING');
</script>
</body>
</html>
